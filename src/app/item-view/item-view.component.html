<div fxLayout="row" *ngIf="loading">
  <mat-spinner></mat-spinner>
</div>
<ng-container [ngSwitch]="view.type" *ngIf="!loading">
  <mat-card>
    <mat-card-subtitle>{{item.type.name}}</mat-card-subtitle>
    <mat-card-title>
      <div fxLayout="row">
        <div fxLayout="column">{{item.name}}</div>
        <div fxLayout="column" fxFlex fxLayoutAlign="end center"  fxFlex="1 1 2%">
          <button mat-icon-button color="primary" [matMenuTriggerFor]="menuMore"><mat-icon>more_vert</mat-icon></button>
        </div>
      </div>
    </mat-card-title>

    <mat-card-content>
      <div *ngIf="item && items.length === 0">
        <app-item-content [item]="item"></app-item-content>
      </div>
      <div *ngIf="item && items.length > 0">
        <div fxLayout="row wrap" class="card-deck-container" fxLayoutAlign="center center" *ngSwitchCase="'Cards'">
          <app-card-view [items]="items" (onRefresh)="refresh()"></app-card-view>
        </div>
        <div *ngSwitchCase="'List'">
          <app-list-view [items]="items" (onRefresh)="refresh()"></app-list-view>
        </div>
        <div *ngSwitchCase="'Map'">
          <app-map-view [item]="item"  [items]="items" [events]="eventsSubject.asObservable()" (centerChanged)="onCenterChanged($event)"></app-map-view>
        </div>
        <div *ngSwitchCase="'Calendar'">
          <app-calendar-view [items]="items" (onRefresh)="refresh()" (onAdd)="add($event)"></app-calendar-view>
        </div>
        <div *ngSwitchCase="'Board'" >
          <app-board-view [items]="items" (onRefresh)="refresh()"></app-board-view>
        </div>
        <div *ngSwitchCase="'Panel'">
          <app-panel-view></app-panel-view>
        </div>
        <div *ngSwitchCase="'Scene'">
          <app-scene-view></app-scene-view>
        </div>
        <div *ngSwitchDefault>
          <app-list-view [items]="items" (onRefresh)="refresh()"></app-list-view>
        </div>
      </div>
      <!--
          <div *ngSwitchCase="'Content'">
            <app-item-content [item]="item"></app-item-content>
          </div>
          <div fxLayout="row wrap" class="card-deck-container" fxLayoutAlign="center center" *ngSwitchCase="'Cards'">
            <app-card-view [items]="items" (onRefresh)="refresh()"></app-card-view>
          </div>
          <div *ngSwitchCase="'List'">
            <app-list-view [items]="items" (onRefresh)="refresh()"></app-list-view>
          </div>
          <div *ngSwitchCase="'Map'">
            <app-map-view [item]="item"  [items]="items" [events]="eventsSubject.asObservable()" (centerChanged)="onCenterChanged($event)"></app-map-view>
          </div>
          <div *ngSwitchCase="'Calendar'">
            <app-calendar-view [items]="items" (onRefresh)="refresh()" (onAdd)="add($event)"></app-calendar-view>
          </div>
          <div *ngSwitchCase="'Board'" >
            <app-board-view [items]="items" (onRefresh)="refresh()"></app-board-view>
          </div>
          <div *ngSwitchCase="'Panel'">
            <app-panel-view></app-panel-view>
          </div>
          <div *ngSwitchCase="'Scene'">
            <app-scene-view></app-scene-view>
          </div>
          <div *ngSwitchDefault>
            Nothing
          </div>
    -->
    </mat-card-content>
    <mat-divider inset></mat-divider>
    <mat-card-actions>
      <!-- <button mat-button>LIKE</button>
      <button mat-button>SHARE</button> -->
    </mat-card-actions>
    <mat-card-footer>
      <!--<mat-progress-bar mode="indeterminate"></mat-progress-bar>-->
      <div fxLayout="row" fxLayoutAlign="center center" *ngIf="!loading && items">
        <div class="paginator mat-elevation-z4" *ngIf="items.length !== 0">
          <mat-paginator
            [length]="paginatorSize"
            [pageSize]="numberOfProductsDisplayedInPage"
            [pageSizeOptions]="[12, 24]"
            (page)="updateProductsDisplayedInPage($event)">
          </mat-paginator>
        </div>
      </div>
    </mat-card-footer>
  </mat-card>

</ng-container>
<mat-menu #menuMore="matMenu" xPosition="before">
  <button *ngIf="canAddItem()" mat-menu-item (click)="onAdd($event)">
    <mat-icon>add</mat-icon>
    <span>Add Item</span>
  </button>
  <button *ngIf="canAddView()" mat-menu-item (click)="onAddView($event)">
    <mat-icon>add</mat-icon>
    <span>Add View</span>
  </button>
  <button *ngIf="canEditOrDeleteItem()" mat-menu-item (click)="onEdit($event)">
    <mat-icon>edit</mat-icon>
    <span>Edit</span>
  </button>
  <button *ngIf="canEditOrDeleteItem()" mat-menu-item (click)="onDelete($event)">
    <mat-icon>delete</mat-icon>
    <span>Delete</span>
  </button>
  <button mat-menu-item (click)="onRefreshClick()">
    <mat-icon>refresh</mat-icon>
    <span>Refresh</span>
  </button>
</mat-menu>
