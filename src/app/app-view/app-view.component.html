<div fxLayout="column" fxLayoutAlign="center center" class="full" fxLayoutGap="12px">
  <ng-container>
    <div class="spinner row" *ngIf="loading" fxLayoutAlign="center center">
      <mat-spinner></mat-spinner>
    </div>
    <div class="example-full-width" fxLayout="row" *ngIf="!loading && !itemContainer" fxLayoutAlign="center center" fxLayoutGap="6px">
      <div fxLayout="row" fxFlex="1 0 5%" *ngIf="item">
        <button mat-icon-button color="primary" (click)="onBack()"><mat-icon>arrow_back</mat-icon></button>
      </div>
      <div fxLayout="row"  fxFlex="1 1 15%" fxLayoutAlign="center center" fxLayoutGap="5px" *ngIf="item">
        <mat-icon>{{item.type.icon}}</mat-icon>
        <div>{{item.name}}</div>
      </div>
      <div fxLayout="row" fxFlex="1 0 83%">
        <mat-form-field fxFlexFill [style.fontSize.px]="10">
          <mat-label>Enter search</mat-label>
          <span matPrefix><mat-icon matSuffix>search</mat-icon>&nbsp;</span>
          <textarea matInput
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="1"
                    cdkAutosizeMaxRows="5"
                    (click)="onEditQueryClick($event)" [value]="getQueryString()" ></textarea>
        </mat-form-field>
      </div>
      <div fxLayout="row" fxFlex fxLayoutAlign="end center"  fxFlex="1 1 2%">
        <button mat-icon-button color="primary" [matMenuTriggerFor]="menuMore"><mat-icon>more_vert</mat-icon></button>
      </div>
    </div>
    <mat-menu #menuMore="matMenu" xPosition="before">
      <button *ngIf="canAddItem()" mat-menu-item (click)="onAdd($event)">
        <mat-icon>add</mat-icon>
        <span>Add Item</span>
      </button>
      <button *ngIf="canAddView()" mat-menu-item (click)="onAddView($event)">
        <mat-icon>add</mat-icon>
        <span>Add View</span>
      </button>
      <button *ngIf="canEditOrDeleteItem()" mat-menu-item (click)="onEdit($event)">
        <mat-icon>edit</mat-icon>
        <span>Edit</span>
      </button>
      <button *ngIf="canEditOrDeleteItem()" mat-menu-item (click)="onDelete($event)">
        <mat-icon>delete</mat-icon>
        <span>Delete</span>
      </button>
      <button mat-menu-item (click)="onRefreshClick()">
        <mat-icon>refresh</mat-icon>
        <span>Refresh</span>
      </button>
    </mat-menu>
    <div fxLayout="row" *ngIf="uploading">
      <mat-spinner></mat-spinner>
    </div>
    <div fxLayout="row" fxLayoutAlign="center center" *ngIf="uploadingFile" class="upload-progress">
      <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
    </div>
    <div class="example-full-width" fxLayout="row" fxLayoutAlign="center center" *ngIf="!loading && itemContainer">
      <app-item-view  class="view-tabs"  [view]="views[0]" [items]="items" [item]="item" [loading]="loading"></app-item-view>
    </div>
    <div class="example-full-width" fxLayout="row" fxLayoutAlign="center center" *ngIf="!loading && views.length > 0 && !itemContainer">
      <mat-tab-group [selectedIndex]="selectedView.value" class="view-tabs"
                     (selectedTabChange)="onChangeTab($event)"
                     (selectedIndexChange)="selectedView.setValue($event)">

        <mat-tab *ngFor="let view of views; let index = index" [label]="view.name">
          <ng-template mat-tab-label>
            <mat-icon class="tab-icon">{{view.icon}}</mat-icon>
            {{view.name}}
            <button mat-icon-button color="primary" *ngIf="allowEditingViews" [matMenuTriggerFor]="viewMenu"><mat-icon>more_vert</mat-icon></button>
            <mat-menu #viewMenu="matMenu" xPosition="before">
              <button  mat-menu-item (click)="onEditView(index)">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button *ngIf="allowEditingViews" mat-menu-item (click)="onDeleteView(index)">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </ng-template>
          <ng-container [ngSwitch]="view.type">
            <div fxLayout="row wrap" class="card-deck-container" fxLayoutAlign="center center" *ngSwitchCase="'Cards'">
              <app-card-view [items]="items" (onRefresh)="refresh()"></app-card-view>
            </div>
            <div *ngSwitchCase="'List'">
              <app-list-view [items]="items" (onRefresh)="refresh()"></app-list-view>
            </div>
            <div *ngSwitchCase="'Map'">
              <app-map-view  [items]="items"  (centerChanged)="onCenterChanged($event)"></app-map-view>
            </div>
            <div *ngSwitchCase="'Calendar'">
              <app-calendar-view [items]="items" (onRefresh)="refresh()" ></app-calendar-view>
            </div>
            <div *ngSwitchCase="'Board'" >
              <app-board-view [items]="items" (onRefresh)="refresh()"></app-board-view>
            </div>
            <div *ngSwitchDefault>
              View not supported
            </div>
          </ng-container>
          <!-- <app-item-view [view]="view" [items]="items" [item]="item" [loading]="loading" [activeTab]="selectedTab === index"  (onRefresh)="refresh()"></app-item-view>-->
        </mat-tab>
      </mat-tab-group>
    </div>


    <div fxLayout="row" fxLayoutAlign="center center" *ngIf="!loading && !itemContainer">
      <div class="paginator mat-elevation-z4" *ngIf="items.length !== 0">
        <mat-paginator
          [length]="paginatorSize"
          [pageSize]="numberOfProductsDisplayedInPage"
          [pageSizeOptions]="[12, 24]"
          (page)="updateProductsDisplayedInPage($event)">
        </mat-paginator>
      </div>
    </div>
  </ng-container>


</div>
